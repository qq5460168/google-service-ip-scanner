name: å®šæ—¶æ‰«æ Google æœåŠ¡ IP

on:
  schedule:
    - cron: '0 */4 * * *'  # æ¯4å°æ—¶è¿è¡Œä¸€æ¬¡ (UTCæ—¶é—´)
  workflow_dispatch:        # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  scan-and-update:
    runs-on: ubuntu-latest
    name: æ‰«æå¹¶æ›´æ–° hosts æ–‡ä»¶
    
    steps:
    - name: æ£€å‡ºä»“åº“
      uses: actions/checkout@v4
      with:
        ref: 'main'
    
    - name: å®‰è£…ä¾èµ–
      run: |
        sudo apt update
        sudo apt install -y jq fping
        
    - name: è¿è¡Œæ‰«æè„šæœ¬
      run: |
        chmod +x scan-google-ip.sh
        ./scan-google-ip.sh
        
    - name: æäº¤ç”Ÿæˆçš„ hosts æ–‡ä»¶
      run: |
        git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git config --local user.name "GitHub Actions"
        
        # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶å˜åŒ–
        if git diff --quiet; then
          echo "æ²¡æœ‰å˜åŒ–ï¼Œè·³è¿‡æäº¤"
        else
          git add google-hosts.txt
          git commit -m "ğŸš€ è‡ªåŠ¨æ›´æ–°: Google æœåŠ¡ hosts æ–‡ä»¶ [$(date +'%Y-%m-%d %H:%M')]"
          git push
        fi